{"version":3,"names":["_deepsignal","require","_signals","_hooks","isObject","item","constructor","Object","deepMerge","target","source","key","getter","getOwnPropertyDescriptor","get","defineProperty","assign","parseInitialData","storeTag","document","querySelector","textContent","JSON","parse","e","stores","exports","Map","rawStores","storeLocks","storeConfigs","objToProxy","WeakMap","proxyToNs","scopeToGetters","proxify","obj","ns","has","proxy","Proxy","handlers","set","receiver","scope","getScope","getters","computed","setNamespace","setScope","call","resetScope","resetNamespace","value","result","Reflect","name","args","gen","it","next","throw","done","getConfig","namespace","getNamespace","universalUnlock","store","state","block","lock","rawStore","deepSignal","proxiedStore","storeLock","isLockValid","Error","data","entries","forEach","config"],"sources":["@wordpress/interactivity/src/store.ts"],"sourcesContent":["/**\n * External dependencies\n */\nimport { deepSignal } from 'deepsignal';\nimport { computed } from '@preact/signals';\n\n/**\n * Internal dependencies\n */\nimport {\n\tgetScope,\n\tsetScope,\n\tresetScope,\n\tgetNamespace,\n\tsetNamespace,\n\tresetNamespace,\n} from './hooks';\n\nconst isObject = ( item: unknown ): item is Record< string, unknown > =>\n\titem && typeof item === 'object' && item.constructor === Object;\n\nconst deepMerge = ( target: any, source: any ) => {\n\tif ( isObject( target ) && isObject( source ) ) {\n\t\tfor ( const key in source ) {\n\t\t\tconst getter = Object.getOwnPropertyDescriptor( source, key )?.get;\n\t\t\tif ( typeof getter === 'function' ) {\n\t\t\t\tObject.defineProperty( target, key, { get: getter } );\n\t\t\t} else if ( isObject( source[ key ] ) ) {\n\t\t\t\tif ( ! target[ key ] ) Object.assign( target, { [ key ]: {} } );\n\t\t\t\tdeepMerge( target[ key ], source[ key ] );\n\t\t\t} else {\n\t\t\t\tObject.assign( target, { [ key ]: source[ key ] } );\n\t\t\t}\n\t\t}\n\t}\n};\n\nconst parseInitialData = () => {\n\tconst storeTag = document.querySelector(\n\t\t`script[type=\"application/json\"]#wp-interactivity-data`\n\t);\n\tif ( storeTag?.textContent ) {\n\t\ttry {\n\t\t\treturn JSON.parse( storeTag.textContent );\n\t\t} catch ( e ) {\n\t\t\t// Do nothing.\n\t\t}\n\t}\n\treturn {};\n};\n\nexport const stores = new Map();\nconst rawStores = new Map();\nconst storeLocks = new Map();\nconst storeConfigs = new Map();\n\nconst objToProxy = new WeakMap();\nconst proxyToNs = new WeakMap();\nconst scopeToGetters = new WeakMap();\n\nconst proxify = ( obj: any, ns: string ) => {\n\tif ( ! objToProxy.has( obj ) ) {\n\t\tconst proxy = new Proxy( obj, handlers );\n\t\tobjToProxy.set( obj, proxy );\n\t\tproxyToNs.set( proxy, ns );\n\t}\n\treturn objToProxy.get( obj );\n};\n\nconst handlers = {\n\tget: ( target: any, key: string | symbol, receiver: any ) => {\n\t\tconst ns = proxyToNs.get( receiver );\n\n\t\t// Check if the property is a getter and we are inside an scope. If that is\n\t\t// the case, we clone the getter to avoid overwriting the scoped\n\t\t// dependencies of the computed each time that getter runs.\n\t\tconst getter = Object.getOwnPropertyDescriptor( target, key )?.get;\n\t\tif ( getter ) {\n\t\t\tconst scope = getScope();\n\t\t\tif ( scope ) {\n\t\t\t\tconst getters =\n\t\t\t\t\tscopeToGetters.get( scope ) ||\n\t\t\t\t\tscopeToGetters.set( scope, new Map() ).get( scope );\n\t\t\t\tif ( ! getters.has( getter ) ) {\n\t\t\t\t\tgetters.set(\n\t\t\t\t\t\tgetter,\n\t\t\t\t\t\tcomputed( () => {\n\t\t\t\t\t\t\tsetNamespace( ns );\n\t\t\t\t\t\t\tsetScope( scope );\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\treturn getter.call( target );\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tresetScope();\n\t\t\t\t\t\t\t\tresetNamespace();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} )\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn getters.get( getter ).value;\n\t\t\t}\n\t\t}\n\n\t\tconst result = Reflect.get( target, key, receiver );\n\n\t\t// Check if the proxy is the store root and no key with that name exist. In\n\t\t// that case, return an empty object for the requested key.\n\t\tif ( typeof result === 'undefined' && receiver === stores.get( ns ) ) {\n\t\t\tconst obj = {};\n\t\t\tReflect.set( target, key, obj, receiver );\n\t\t\treturn proxify( obj, ns );\n\t\t}\n\n\t\t// Check if the property is a generator. If it is, we turn it into an\n\t\t// asynchronous function where we restore the default namespace and scope\n\t\t// each time it awaits/yields.\n\t\tif ( result?.constructor?.name === 'GeneratorFunction' ) {\n\t\t\treturn async ( ...args: unknown[] ) => {\n\t\t\t\tconst scope = getScope();\n\t\t\t\tconst gen: Generator< any > = result( ...args );\n\n\t\t\t\tlet value: any;\n\t\t\t\tlet it: IteratorResult< any >;\n\n\t\t\t\twhile ( true ) {\n\t\t\t\t\tsetNamespace( ns );\n\t\t\t\t\tsetScope( scope );\n\t\t\t\t\ttry {\n\t\t\t\t\t\tit = gen.next( value );\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tresetScope();\n\t\t\t\t\t\tresetNamespace();\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = await it.value;\n\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\tgen.throw( e );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( it.done ) break;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t};\n\t\t}\n\n\t\t// Check if the property is a synchronous function. If it is, set the\n\t\t// default namespace. Synchronous functions always run in the proper scope,\n\t\t// which is set by the Directives component.\n\t\tif ( typeof result === 'function' ) {\n\t\t\treturn ( ...args: unknown[] ) => {\n\t\t\t\tsetNamespace( ns );\n\t\t\t\ttry {\n\t\t\t\t\treturn result( ...args );\n\t\t\t\t} finally {\n\t\t\t\t\tresetNamespace();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t// Check if the property is an object. If it is, proxyify it.\n\t\tif ( isObject( result ) ) return proxify( result, ns );\n\n\t\treturn result;\n\t},\n};\n\n/**\n * Get the defined config for the store with the passed namespace.\n *\n * @param namespace Store's namespace from which to retrieve the config.\n * @return Defined config for the given namespace.\n */\nexport const getConfig = ( namespace: string ) =>\n\tstoreConfigs.get( namespace || getNamespace() ) || {};\n\ninterface StoreOptions {\n\t/**\n\t * Property to block/unblock private store namespaces.\n\t *\n\t * If the passed value is `true`, it blocks the given namespace, making it\n\t * accessible only trough the returned variables of the `store()` call. In\n\t * the case a lock string is passed, it also blocks the namespace, but can\n\t * be unblocked for other `store()` calls using the same lock string.\n\t *\n\t * @example\n\t * ```\n\t * // The store can only be accessed where the `state` const can.\n\t * const { state } = store( 'myblock/private', { ... }, { lock: true } );\n\t * ```\n\t *\n\t * @example\n\t * ```\n\t * // Other modules knowing `SECRET_LOCK_STRING` can access the namespace.\n\t * const { state } = store(\n\t *   'myblock/private',\n\t *   { ... },\n\t *   { lock: 'SECRET_LOCK_STRING' }\n\t * );\n\t * ```\n\t */\n\tlock?: boolean | string;\n}\n\nconst universalUnlock =\n\t'I acknowledge that using a private store means my plugin will inevitably break on the next store release.';\n\n/**\n * Extends the Interactivity API global store adding the passed properties to\n * the given namespace. It also returns stable references to the namespace\n * content.\n *\n * These props typically consist of `state`, which is the reactive part of the\n * store ― which means that any directive referencing a state property will be\n * re-rendered anytime it changes ― and function properties like `actions` and\n * `callbacks`, mostly used for event handlers. These props can then be\n * referenced by any directive to make the HTML interactive.\n *\n * @example\n * ```js\n *  const { state } = store( 'counter', {\n *    state: {\n *      value: 0,\n *      get double() { return state.value * 2; },\n *    },\n *    actions: {\n *      increment() {\n *        state.value += 1;\n *      },\n *    },\n *  } );\n * ```\n *\n * The code from the example above allows blocks to subscribe and interact with\n * the store by using directives in the HTML, e.g.:\n *\n * ```html\n * <div data-wp-interactive=\"counter\">\n *   <button\n *     data-wp-text=\"state.double\"\n *     data-wp-on--click=\"actions.increment\"\n *   >\n *     0\n *   </button>\n * </div>\n * ```\n * @param namespace The store namespace to interact with.\n * @param storePart Properties to add to the store namespace.\n * @param options   Options for the given namespace.\n *\n * @return A reference to the namespace content.\n */\nexport function store< S extends object = {} >(\n\tnamespace: string,\n\tstorePart?: S,\n\toptions?: StoreOptions\n): S;\n\nexport function store< T extends object >(\n\tnamespace: string,\n\tstorePart?: T,\n\toptions?: StoreOptions\n): T;\n\nexport function store(\n\tnamespace: string,\n\t{ state = {}, ...block }: any = {},\n\t{ lock = false }: StoreOptions = {}\n) {\n\tif ( ! stores.has( namespace ) ) {\n\t\t// Lock the store if the passed lock is different from the universal\n\t\t// unlock. Once the lock is set (either false, true, or a given string),\n\t\t// it cannot change.\n\t\tif ( lock !== universalUnlock ) {\n\t\t\tstoreLocks.set( namespace, lock );\n\t\t}\n\t\tconst rawStore = { state: deepSignal( state ), ...block };\n\t\tconst proxiedStore = new Proxy( rawStore, handlers );\n\t\trawStores.set( namespace, rawStore );\n\t\tstores.set( namespace, proxiedStore );\n\t\tproxyToNs.set( proxiedStore, namespace );\n\t} else {\n\t\t// Lock the store if it wasn't locked yet and the passed lock is\n\t\t// different from the universal unlock. If no lock is given, the store\n\t\t// will be public and won't accept any lock from now on.\n\t\tif ( lock !== universalUnlock && ! storeLocks.has( namespace ) ) {\n\t\t\tstoreLocks.set( namespace, lock );\n\t\t} else {\n\t\t\tconst storeLock = storeLocks.get( namespace );\n\t\t\tconst isLockValid =\n\t\t\t\tlock === universalUnlock ||\n\t\t\t\t( lock !== true && lock === storeLock );\n\n\t\t\tif ( ! isLockValid ) {\n\t\t\t\tif ( ! storeLock ) {\n\t\t\t\t\tthrow Error( 'Cannot lock a public store' );\n\t\t\t\t} else {\n\t\t\t\t\tthrow Error(\n\t\t\t\t\t\t'Cannot unlock a private store with an invalid lock code'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst target = rawStores.get( namespace );\n\t\tdeepMerge( target, block );\n\t\tdeepMerge( target.state, state );\n\t}\n\n\treturn stores.get( namespace );\n}\n\n// Parse and populate the initial state and config.\nconst data = parseInitialData();\nif ( isObject( data?.state ) ) {\n\tObject.entries( data.state ).forEach( ( [ namespace, state ] ) => {\n\t\tstore( namespace, { state }, { lock: universalUnlock } );\n\t} );\n}\nif ( isObject( data?.config ) ) {\n\tObject.entries( data.config ).forEach( ( [ namespace, config ] ) => {\n\t\tstoreConfigs.set( namespace, config );\n\t} );\n}\n"],"mappings":";;;;;;;;AAGA,IAAAA,WAAA,GAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AAKA,IAAAE,MAAA,GAAAF,OAAA;AATA;AACA;AACA;;AAIA;AACA;AACA;;AAUA,MAAMG,QAAQ,GAAKC,IAAa,IAC/BA,IAAI,IAAI,OAAOA,IAAI,KAAK,QAAQ,IAAIA,IAAI,CAACC,WAAW,KAAKC,MAAM;AAEhE,MAAMC,SAAS,GAAGA,CAAEC,MAAW,EAAEC,MAAW,KAAM;EACjD,IAAKN,QAAQ,CAAEK,MAAO,CAAC,IAAIL,QAAQ,CAAEM,MAAO,CAAC,EAAG;IAC/C,KAAM,MAAMC,GAAG,IAAID,MAAM,EAAG;MAC3B,MAAME,MAAM,GAAGL,MAAM,CAACM,wBAAwB,CAAEH,MAAM,EAAEC,GAAI,CAAC,EAAEG,GAAG;MAClE,IAAK,OAAOF,MAAM,KAAK,UAAU,EAAG;QACnCL,MAAM,CAACQ,cAAc,CAAEN,MAAM,EAAEE,GAAG,EAAE;UAAEG,GAAG,EAAEF;QAAO,CAAE,CAAC;MACtD,CAAC,MAAM,IAAKR,QAAQ,CAAEM,MAAM,CAAEC,GAAG,CAAG,CAAC,EAAG;QACvC,IAAK,CAAEF,MAAM,CAAEE,GAAG,CAAE,EAAGJ,MAAM,CAACS,MAAM,CAAEP,MAAM,EAAE;UAAE,CAAEE,GAAG,GAAI,CAAC;QAAE,CAAE,CAAC;QAC/DH,SAAS,CAAEC,MAAM,CAAEE,GAAG,CAAE,EAAED,MAAM,CAAEC,GAAG,CAAG,CAAC;MAC1C,CAAC,MAAM;QACNJ,MAAM,CAACS,MAAM,CAAEP,MAAM,EAAE;UAAE,CAAEE,GAAG,GAAID,MAAM,CAAEC,GAAG;QAAG,CAAE,CAAC;MACpD;IACD;EACD;AACD,CAAC;AAED,MAAMM,gBAAgB,GAAGA,CAAA,KAAM;EAC9B,MAAMC,QAAQ,GAAGC,QAAQ,CAACC,aAAa,CACrC,uDACF,CAAC;EACD,IAAKF,QAAQ,EAAEG,WAAW,EAAG;IAC5B,IAAI;MACH,OAAOC,IAAI,CAACC,KAAK,CAAEL,QAAQ,CAACG,WAAY,CAAC;IAC1C,CAAC,CAAC,OAAQG,CAAC,EAAG;MACb;IAAA;EAEF;EACA,OAAO,CAAC,CAAC;AACV,CAAC;AAEM,MAAMC,MAAM,GAAAC,OAAA,CAAAD,MAAA,GAAG,IAAIE,GAAG,CAAC,CAAC;AAC/B,MAAMC,SAAS,GAAG,IAAID,GAAG,CAAC,CAAC;AAC3B,MAAME,UAAU,GAAG,IAAIF,GAAG,CAAC,CAAC;AAC5B,MAAMG,YAAY,GAAG,IAAIH,GAAG,CAAC,CAAC;AAE9B,MAAMI,UAAU,GAAG,IAAIC,OAAO,CAAC,CAAC;AAChC,MAAMC,SAAS,GAAG,IAAID,OAAO,CAAC,CAAC;AAC/B,MAAME,cAAc,GAAG,IAAIF,OAAO,CAAC,CAAC;AAEpC,MAAMG,OAAO,GAAGA,CAAEC,GAAQ,EAAEC,EAAU,KAAM;EAC3C,IAAK,CAAEN,UAAU,CAACO,GAAG,CAAEF,GAAI,CAAC,EAAG;IAC9B,MAAMG,KAAK,GAAG,IAAIC,KAAK,CAAEJ,GAAG,EAAEK,QAAS,CAAC;IACxCV,UAAU,CAACW,GAAG,CAAEN,GAAG,EAAEG,KAAM,CAAC;IAC5BN,SAAS,CAACS,GAAG,CAAEH,KAAK,EAAEF,EAAG,CAAC;EAC3B;EACA,OAAON,UAAU,CAACjB,GAAG,CAAEsB,GAAI,CAAC;AAC7B,CAAC;AAED,MAAMK,QAAQ,GAAG;EAChB3B,GAAG,EAAEA,CAAEL,MAAW,EAAEE,GAAoB,EAAEgC,QAAa,KAAM;IAC5D,MAAMN,EAAE,GAAGJ,SAAS,CAACnB,GAAG,CAAE6B,QAAS,CAAC;;IAEpC;IACA;IACA;IACA,MAAM/B,MAAM,GAAGL,MAAM,CAACM,wBAAwB,CAAEJ,MAAM,EAAEE,GAAI,CAAC,EAAEG,GAAG;IAClE,IAAKF,MAAM,EAAG;MACb,MAAMgC,KAAK,GAAG,IAAAC,eAAQ,EAAC,CAAC;MACxB,IAAKD,KAAK,EAAG;QACZ,MAAME,OAAO,GACZZ,cAAc,CAACpB,GAAG,CAAE8B,KAAM,CAAC,IAC3BV,cAAc,CAACQ,GAAG,CAAEE,KAAK,EAAE,IAAIjB,GAAG,CAAC,CAAE,CAAC,CAACb,GAAG,CAAE8B,KAAM,CAAC;QACpD,IAAK,CAAEE,OAAO,CAACR,GAAG,CAAE1B,MAAO,CAAC,EAAG;UAC9BkC,OAAO,CAACJ,GAAG,CACV9B,MAAM,EACN,IAAAmC,iBAAQ,EAAE,MAAM;YACf,IAAAC,mBAAY,EAAEX,EAAG,CAAC;YAClB,IAAAY,eAAQ,EAAEL,KAAM,CAAC;YACjB,IAAI;cACH,OAAOhC,MAAM,CAACsC,IAAI,CAAEzC,MAAO,CAAC;YAC7B,CAAC,SAAS;cACT,IAAA0C,iBAAU,EAAC,CAAC;cACZ,IAAAC,qBAAc,EAAC,CAAC;YACjB;UACD,CAAE,CACH,CAAC;QACF;QACA,OAAON,OAAO,CAAChC,GAAG,CAAEF,MAAO,CAAC,CAACyC,KAAK;MACnC;IACD;IAEA,MAAMC,MAAM,GAAGC,OAAO,CAACzC,GAAG,CAAEL,MAAM,EAAEE,GAAG,EAAEgC,QAAS,CAAC;;IAEnD;IACA;IACA,IAAK,OAAOW,MAAM,KAAK,WAAW,IAAIX,QAAQ,KAAKlB,MAAM,CAACX,GAAG,CAAEuB,EAAG,CAAC,EAAG;MACrE,MAAMD,GAAG,GAAG,CAAC,CAAC;MACdmB,OAAO,CAACb,GAAG,CAAEjC,MAAM,EAAEE,GAAG,EAAEyB,GAAG,EAAEO,QAAS,CAAC;MACzC,OAAOR,OAAO,CAAEC,GAAG,EAAEC,EAAG,CAAC;IAC1B;;IAEA;IACA;IACA;IACA,IAAKiB,MAAM,EAAEhD,WAAW,EAAEkD,IAAI,KAAK,mBAAmB,EAAG;MACxD,OAAO,OAAQ,GAAGC,IAAe,KAAM;QACtC,MAAMb,KAAK,GAAG,IAAAC,eAAQ,EAAC,CAAC;QACxB,MAAMa,GAAqB,GAAGJ,MAAM,CAAE,GAAGG,IAAK,CAAC;QAE/C,IAAIJ,KAAU;QACd,IAAIM,EAAyB;QAE7B,OAAQ,IAAI,EAAG;UACd,IAAAX,mBAAY,EAAEX,EAAG,CAAC;UAClB,IAAAY,eAAQ,EAAEL,KAAM,CAAC;UACjB,IAAI;YACHe,EAAE,GAAGD,GAAG,CAACE,IAAI,CAAEP,KAAM,CAAC;UACvB,CAAC,SAAS;YACT,IAAAF,iBAAU,EAAC,CAAC;YACZ,IAAAC,qBAAc,EAAC,CAAC;UACjB;UAEA,IAAI;YACHC,KAAK,GAAG,MAAMM,EAAE,CAACN,KAAK;UACvB,CAAC,CAAC,OAAQ7B,CAAC,EAAG;YACbkC,GAAG,CAACG,KAAK,CAAErC,CAAE,CAAC;UACf;UAEA,IAAKmC,EAAE,CAACG,IAAI,EAAG;QAChB;QAEA,OAAOT,KAAK;MACb,CAAC;IACF;;IAEA;IACA;IACA;IACA,IAAK,OAAOC,MAAM,KAAK,UAAU,EAAG;MACnC,OAAO,CAAE,GAAGG,IAAe,KAAM;QAChC,IAAAT,mBAAY,EAAEX,EAAG,CAAC;QAClB,IAAI;UACH,OAAOiB,MAAM,CAAE,GAAGG,IAAK,CAAC;QACzB,CAAC,SAAS;UACT,IAAAL,qBAAc,EAAC,CAAC;QACjB;MACD,CAAC;IACF;;IAEA;IACA,IAAKhD,QAAQ,CAAEkD,MAAO,CAAC,EAAG,OAAOnB,OAAO,CAAEmB,MAAM,EAAEjB,EAAG,CAAC;IAEtD,OAAOiB,MAAM;EACd;AACD,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACO,MAAMS,SAAS,GAAKC,SAAiB,IAC3ClC,YAAY,CAAChB,GAAG,CAAEkD,SAAS,IAAI,IAAAC,mBAAY,EAAC,CAAE,CAAC,IAAI,CAAC,CAAC;AAACvC,OAAA,CAAAqC,SAAA,GAAAA,SAAA;AA8BvD,MAAMG,eAAe,GACpB,2GAA2G;;AAE5G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAaO,SAASC,KAAKA,CACpBH,SAAiB,EACjB;EAAEI,KAAK,GAAG,CAAC,CAAC;EAAE,GAAGC;AAAW,CAAC,GAAG,CAAC,CAAC,EAClC;EAAEC,IAAI,GAAG;AAAoB,CAAC,GAAG,CAAC,CAAC,EAClC;EACD,IAAK,CAAE7C,MAAM,CAACa,GAAG,CAAE0B,SAAU,CAAC,EAAG;IAChC;IACA;IACA;IACA,IAAKM,IAAI,KAAKJ,eAAe,EAAG;MAC/BrC,UAAU,CAACa,GAAG,CAAEsB,SAAS,EAAEM,IAAK,CAAC;IAClC;IACA,MAAMC,QAAQ,GAAG;MAAEH,KAAK,EAAE,IAAAI,sBAAU,EAAEJ,KAAM,CAAC;MAAE,GAAGC;IAAM,CAAC;IACzD,MAAMI,YAAY,GAAG,IAAIjC,KAAK,CAAE+B,QAAQ,EAAE9B,QAAS,CAAC;IACpDb,SAAS,CAACc,GAAG,CAAEsB,SAAS,EAAEO,QAAS,CAAC;IACpC9C,MAAM,CAACiB,GAAG,CAAEsB,SAAS,EAAES,YAAa,CAAC;IACrCxC,SAAS,CAACS,GAAG,CAAE+B,YAAY,EAAET,SAAU,CAAC;EACzC,CAAC,MAAM;IACN;IACA;IACA;IACA,IAAKM,IAAI,KAAKJ,eAAe,IAAI,CAAErC,UAAU,CAACS,GAAG,CAAE0B,SAAU,CAAC,EAAG;MAChEnC,UAAU,CAACa,GAAG,CAAEsB,SAAS,EAAEM,IAAK,CAAC;IAClC,CAAC,MAAM;MACN,MAAMI,SAAS,GAAG7C,UAAU,CAACf,GAAG,CAAEkD,SAAU,CAAC;MAC7C,MAAMW,WAAW,GAChBL,IAAI,KAAKJ,eAAe,IACtBI,IAAI,KAAK,IAAI,IAAIA,IAAI,KAAKI,SAAW;MAExC,IAAK,CAAEC,WAAW,EAAG;QACpB,IAAK,CAAED,SAAS,EAAG;UAClB,MAAME,KAAK,CAAE,4BAA6B,CAAC;QAC5C,CAAC,MAAM;UACN,MAAMA,KAAK,CACV,yDACD,CAAC;QACF;MACD;IACD;IAEA,MAAMnE,MAAM,GAAGmB,SAAS,CAACd,GAAG,CAAEkD,SAAU,CAAC;IACzCxD,SAAS,CAAEC,MAAM,EAAE4D,KAAM,CAAC;IAC1B7D,SAAS,CAAEC,MAAM,CAAC2D,KAAK,EAAEA,KAAM,CAAC;EACjC;EAEA,OAAO3C,MAAM,CAACX,GAAG,CAAEkD,SAAU,CAAC;AAC/B;;AAEA;AACA,MAAMa,IAAI,GAAG5D,gBAAgB,CAAC,CAAC;AAC/B,IAAKb,QAAQ,CAAEyE,IAAI,EAAET,KAAM,CAAC,EAAG;EAC9B7D,MAAM,CAACuE,OAAO,CAAED,IAAI,CAACT,KAAM,CAAC,CAACW,OAAO,CAAE,CAAE,CAAEf,SAAS,EAAEI,KAAK,CAAE,KAAM;IACjED,KAAK,CAAEH,SAAS,EAAE;MAAEI;IAAM,CAAC,EAAE;MAAEE,IAAI,EAAEJ;IAAgB,CAAE,CAAC;EACzD,CAAE,CAAC;AACJ;AACA,IAAK9D,QAAQ,CAAEyE,IAAI,EAAEG,MAAO,CAAC,EAAG;EAC/BzE,MAAM,CAACuE,OAAO,CAAED,IAAI,CAACG,MAAO,CAAC,CAACD,OAAO,CAAE,CAAE,CAAEf,SAAS,EAAEgB,MAAM,CAAE,KAAM;IACnElD,YAAY,CAACY,GAAG,CAAEsB,SAAS,EAAEgB,MAAO,CAAC;EACtC,CAAE,CAAC;AACJ"}