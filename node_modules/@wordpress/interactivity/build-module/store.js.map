{"version":3,"names":["deepSignal","computed","getScope","setScope","resetScope","getNamespace","setNamespace","resetNamespace","isObject","item","constructor","Object","deepMerge","target","source","key","getter","getOwnPropertyDescriptor","get","defineProperty","assign","parseInitialData","storeTag","document","querySelector","textContent","JSON","parse","e","stores","Map","rawStores","storeLocks","storeConfigs","objToProxy","WeakMap","proxyToNs","scopeToGetters","proxify","obj","ns","has","proxy","Proxy","handlers","set","receiver","scope","getters","call","value","result","Reflect","name","args","gen","it","next","throw","done","getConfig","namespace","universalUnlock","store","state","block","lock","rawStore","proxiedStore","storeLock","isLockValid","Error","data","entries","forEach","config"],"sources":["@wordpress/interactivity/src/store.ts"],"sourcesContent":["/**\n * External dependencies\n */\nimport { deepSignal } from 'deepsignal';\nimport { computed } from '@preact/signals';\n\n/**\n * Internal dependencies\n */\nimport {\n\tgetScope,\n\tsetScope,\n\tresetScope,\n\tgetNamespace,\n\tsetNamespace,\n\tresetNamespace,\n} from './hooks';\n\nconst isObject = ( item: unknown ): item is Record< string, unknown > =>\n\titem && typeof item === 'object' && item.constructor === Object;\n\nconst deepMerge = ( target: any, source: any ) => {\n\tif ( isObject( target ) && isObject( source ) ) {\n\t\tfor ( const key in source ) {\n\t\t\tconst getter = Object.getOwnPropertyDescriptor( source, key )?.get;\n\t\t\tif ( typeof getter === 'function' ) {\n\t\t\t\tObject.defineProperty( target, key, { get: getter } );\n\t\t\t} else if ( isObject( source[ key ] ) ) {\n\t\t\t\tif ( ! target[ key ] ) Object.assign( target, { [ key ]: {} } );\n\t\t\t\tdeepMerge( target[ key ], source[ key ] );\n\t\t\t} else {\n\t\t\t\tObject.assign( target, { [ key ]: source[ key ] } );\n\t\t\t}\n\t\t}\n\t}\n};\n\nconst parseInitialData = () => {\n\tconst storeTag = document.querySelector(\n\t\t`script[type=\"application/json\"]#wp-interactivity-data`\n\t);\n\tif ( storeTag?.textContent ) {\n\t\ttry {\n\t\t\treturn JSON.parse( storeTag.textContent );\n\t\t} catch ( e ) {\n\t\t\t// Do nothing.\n\t\t}\n\t}\n\treturn {};\n};\n\nexport const stores = new Map();\nconst rawStores = new Map();\nconst storeLocks = new Map();\nconst storeConfigs = new Map();\n\nconst objToProxy = new WeakMap();\nconst proxyToNs = new WeakMap();\nconst scopeToGetters = new WeakMap();\n\nconst proxify = ( obj: any, ns: string ) => {\n\tif ( ! objToProxy.has( obj ) ) {\n\t\tconst proxy = new Proxy( obj, handlers );\n\t\tobjToProxy.set( obj, proxy );\n\t\tproxyToNs.set( proxy, ns );\n\t}\n\treturn objToProxy.get( obj );\n};\n\nconst handlers = {\n\tget: ( target: any, key: string | symbol, receiver: any ) => {\n\t\tconst ns = proxyToNs.get( receiver );\n\n\t\t// Check if the property is a getter and we are inside an scope. If that is\n\t\t// the case, we clone the getter to avoid overwriting the scoped\n\t\t// dependencies of the computed each time that getter runs.\n\t\tconst getter = Object.getOwnPropertyDescriptor( target, key )?.get;\n\t\tif ( getter ) {\n\t\t\tconst scope = getScope();\n\t\t\tif ( scope ) {\n\t\t\t\tconst getters =\n\t\t\t\t\tscopeToGetters.get( scope ) ||\n\t\t\t\t\tscopeToGetters.set( scope, new Map() ).get( scope );\n\t\t\t\tif ( ! getters.has( getter ) ) {\n\t\t\t\t\tgetters.set(\n\t\t\t\t\t\tgetter,\n\t\t\t\t\t\tcomputed( () => {\n\t\t\t\t\t\t\tsetNamespace( ns );\n\t\t\t\t\t\t\tsetScope( scope );\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\treturn getter.call( target );\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tresetScope();\n\t\t\t\t\t\t\t\tresetNamespace();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} )\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn getters.get( getter ).value;\n\t\t\t}\n\t\t}\n\n\t\tconst result = Reflect.get( target, key, receiver );\n\n\t\t// Check if the proxy is the store root and no key with that name exist. In\n\t\t// that case, return an empty object for the requested key.\n\t\tif ( typeof result === 'undefined' && receiver === stores.get( ns ) ) {\n\t\t\tconst obj = {};\n\t\t\tReflect.set( target, key, obj, receiver );\n\t\t\treturn proxify( obj, ns );\n\t\t}\n\n\t\t// Check if the property is a generator. If it is, we turn it into an\n\t\t// asynchronous function where we restore the default namespace and scope\n\t\t// each time it awaits/yields.\n\t\tif ( result?.constructor?.name === 'GeneratorFunction' ) {\n\t\t\treturn async ( ...args: unknown[] ) => {\n\t\t\t\tconst scope = getScope();\n\t\t\t\tconst gen: Generator< any > = result( ...args );\n\n\t\t\t\tlet value: any;\n\t\t\t\tlet it: IteratorResult< any >;\n\n\t\t\t\twhile ( true ) {\n\t\t\t\t\tsetNamespace( ns );\n\t\t\t\t\tsetScope( scope );\n\t\t\t\t\ttry {\n\t\t\t\t\t\tit = gen.next( value );\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tresetScope();\n\t\t\t\t\t\tresetNamespace();\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = await it.value;\n\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\tgen.throw( e );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( it.done ) break;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t};\n\t\t}\n\n\t\t// Check if the property is a synchronous function. If it is, set the\n\t\t// default namespace. Synchronous functions always run in the proper scope,\n\t\t// which is set by the Directives component.\n\t\tif ( typeof result === 'function' ) {\n\t\t\treturn ( ...args: unknown[] ) => {\n\t\t\t\tsetNamespace( ns );\n\t\t\t\ttry {\n\t\t\t\t\treturn result( ...args );\n\t\t\t\t} finally {\n\t\t\t\t\tresetNamespace();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t// Check if the property is an object. If it is, proxyify it.\n\t\tif ( isObject( result ) ) return proxify( result, ns );\n\n\t\treturn result;\n\t},\n};\n\n/**\n * Get the defined config for the store with the passed namespace.\n *\n * @param namespace Store's namespace from which to retrieve the config.\n * @return Defined config for the given namespace.\n */\nexport const getConfig = ( namespace: string ) =>\n\tstoreConfigs.get( namespace || getNamespace() ) || {};\n\ninterface StoreOptions {\n\t/**\n\t * Property to block/unblock private store namespaces.\n\t *\n\t * If the passed value is `true`, it blocks the given namespace, making it\n\t * accessible only trough the returned variables of the `store()` call. In\n\t * the case a lock string is passed, it also blocks the namespace, but can\n\t * be unblocked for other `store()` calls using the same lock string.\n\t *\n\t * @example\n\t * ```\n\t * // The store can only be accessed where the `state` const can.\n\t * const { state } = store( 'myblock/private', { ... }, { lock: true } );\n\t * ```\n\t *\n\t * @example\n\t * ```\n\t * // Other modules knowing `SECRET_LOCK_STRING` can access the namespace.\n\t * const { state } = store(\n\t *   'myblock/private',\n\t *   { ... },\n\t *   { lock: 'SECRET_LOCK_STRING' }\n\t * );\n\t * ```\n\t */\n\tlock?: boolean | string;\n}\n\nconst universalUnlock =\n\t'I acknowledge that using a private store means my plugin will inevitably break on the next store release.';\n\n/**\n * Extends the Interactivity API global store adding the passed properties to\n * the given namespace. It also returns stable references to the namespace\n * content.\n *\n * These props typically consist of `state`, which is the reactive part of the\n * store ― which means that any directive referencing a state property will be\n * re-rendered anytime it changes ― and function properties like `actions` and\n * `callbacks`, mostly used for event handlers. These props can then be\n * referenced by any directive to make the HTML interactive.\n *\n * @example\n * ```js\n *  const { state } = store( 'counter', {\n *    state: {\n *      value: 0,\n *      get double() { return state.value * 2; },\n *    },\n *    actions: {\n *      increment() {\n *        state.value += 1;\n *      },\n *    },\n *  } );\n * ```\n *\n * The code from the example above allows blocks to subscribe and interact with\n * the store by using directives in the HTML, e.g.:\n *\n * ```html\n * <div data-wp-interactive=\"counter\">\n *   <button\n *     data-wp-text=\"state.double\"\n *     data-wp-on--click=\"actions.increment\"\n *   >\n *     0\n *   </button>\n * </div>\n * ```\n * @param namespace The store namespace to interact with.\n * @param storePart Properties to add to the store namespace.\n * @param options   Options for the given namespace.\n *\n * @return A reference to the namespace content.\n */\nexport function store< S extends object = {} >(\n\tnamespace: string,\n\tstorePart?: S,\n\toptions?: StoreOptions\n): S;\n\nexport function store< T extends object >(\n\tnamespace: string,\n\tstorePart?: T,\n\toptions?: StoreOptions\n): T;\n\nexport function store(\n\tnamespace: string,\n\t{ state = {}, ...block }: any = {},\n\t{ lock = false }: StoreOptions = {}\n) {\n\tif ( ! stores.has( namespace ) ) {\n\t\t// Lock the store if the passed lock is different from the universal\n\t\t// unlock. Once the lock is set (either false, true, or a given string),\n\t\t// it cannot change.\n\t\tif ( lock !== universalUnlock ) {\n\t\t\tstoreLocks.set( namespace, lock );\n\t\t}\n\t\tconst rawStore = { state: deepSignal( state ), ...block };\n\t\tconst proxiedStore = new Proxy( rawStore, handlers );\n\t\trawStores.set( namespace, rawStore );\n\t\tstores.set( namespace, proxiedStore );\n\t\tproxyToNs.set( proxiedStore, namespace );\n\t} else {\n\t\t// Lock the store if it wasn't locked yet and the passed lock is\n\t\t// different from the universal unlock. If no lock is given, the store\n\t\t// will be public and won't accept any lock from now on.\n\t\tif ( lock !== universalUnlock && ! storeLocks.has( namespace ) ) {\n\t\t\tstoreLocks.set( namespace, lock );\n\t\t} else {\n\t\t\tconst storeLock = storeLocks.get( namespace );\n\t\t\tconst isLockValid =\n\t\t\t\tlock === universalUnlock ||\n\t\t\t\t( lock !== true && lock === storeLock );\n\n\t\t\tif ( ! isLockValid ) {\n\t\t\t\tif ( ! storeLock ) {\n\t\t\t\t\tthrow Error( 'Cannot lock a public store' );\n\t\t\t\t} else {\n\t\t\t\t\tthrow Error(\n\t\t\t\t\t\t'Cannot unlock a private store with an invalid lock code'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst target = rawStores.get( namespace );\n\t\tdeepMerge( target, block );\n\t\tdeepMerge( target.state, state );\n\t}\n\n\treturn stores.get( namespace );\n}\n\n// Parse and populate the initial state and config.\nconst data = parseInitialData();\nif ( isObject( data?.state ) ) {\n\tObject.entries( data.state ).forEach( ( [ namespace, state ] ) => {\n\t\tstore( namespace, { state }, { lock: universalUnlock } );\n\t} );\n}\nif ( isObject( data?.config ) ) {\n\tObject.entries( data.config ).forEach( ( [ namespace, config ] ) => {\n\t\tstoreConfigs.set( namespace, config );\n\t} );\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,UAAU,QAAQ,YAAY;AACvC,SAASC,QAAQ,QAAQ,iBAAiB;;AAE1C;AACA;AACA;AACA,SACCC,QAAQ,EACRC,QAAQ,EACRC,UAAU,EACVC,YAAY,EACZC,YAAY,EACZC,cAAc,QACR,SAAS;AAEhB,MAAMC,QAAQ,GAAKC,IAAa,IAC/BA,IAAI,IAAI,OAAOA,IAAI,KAAK,QAAQ,IAAIA,IAAI,CAACC,WAAW,KAAKC,MAAM;AAEhE,MAAMC,SAAS,GAAGA,CAAEC,MAAW,EAAEC,MAAW,KAAM;EACjD,IAAKN,QAAQ,CAAEK,MAAO,CAAC,IAAIL,QAAQ,CAAEM,MAAO,CAAC,EAAG;IAC/C,KAAM,MAAMC,GAAG,IAAID,MAAM,EAAG;MAC3B,MAAME,MAAM,GAAGL,MAAM,CAACM,wBAAwB,CAAEH,MAAM,EAAEC,GAAI,CAAC,EAAEG,GAAG;MAClE,IAAK,OAAOF,MAAM,KAAK,UAAU,EAAG;QACnCL,MAAM,CAACQ,cAAc,CAAEN,MAAM,EAAEE,GAAG,EAAE;UAAEG,GAAG,EAAEF;QAAO,CAAE,CAAC;MACtD,CAAC,MAAM,IAAKR,QAAQ,CAAEM,MAAM,CAAEC,GAAG,CAAG,CAAC,EAAG;QACvC,IAAK,CAAEF,MAAM,CAAEE,GAAG,CAAE,EAAGJ,MAAM,CAACS,MAAM,CAAEP,MAAM,EAAE;UAAE,CAAEE,GAAG,GAAI,CAAC;QAAE,CAAE,CAAC;QAC/DH,SAAS,CAAEC,MAAM,CAAEE,GAAG,CAAE,EAAED,MAAM,CAAEC,GAAG,CAAG,CAAC;MAC1C,CAAC,MAAM;QACNJ,MAAM,CAACS,MAAM,CAAEP,MAAM,EAAE;UAAE,CAAEE,GAAG,GAAID,MAAM,CAAEC,GAAG;QAAG,CAAE,CAAC;MACpD;IACD;EACD;AACD,CAAC;AAED,MAAMM,gBAAgB,GAAGA,CAAA,KAAM;EAC9B,MAAMC,QAAQ,GAAGC,QAAQ,CAACC,aAAa,CACrC,uDACF,CAAC;EACD,IAAKF,QAAQ,EAAEG,WAAW,EAAG;IAC5B,IAAI;MACH,OAAOC,IAAI,CAACC,KAAK,CAAEL,QAAQ,CAACG,WAAY,CAAC;IAC1C,CAAC,CAAC,OAAQG,CAAC,EAAG;MACb;IAAA;EAEF;EACA,OAAO,CAAC,CAAC;AACV,CAAC;AAED,OAAO,MAAMC,MAAM,GAAG,IAAIC,GAAG,CAAC,CAAC;AAC/B,MAAMC,SAAS,GAAG,IAAID,GAAG,CAAC,CAAC;AAC3B,MAAME,UAAU,GAAG,IAAIF,GAAG,CAAC,CAAC;AAC5B,MAAMG,YAAY,GAAG,IAAIH,GAAG,CAAC,CAAC;AAE9B,MAAMI,UAAU,GAAG,IAAIC,OAAO,CAAC,CAAC;AAChC,MAAMC,SAAS,GAAG,IAAID,OAAO,CAAC,CAAC;AAC/B,MAAME,cAAc,GAAG,IAAIF,OAAO,CAAC,CAAC;AAEpC,MAAMG,OAAO,GAAGA,CAAEC,GAAQ,EAAEC,EAAU,KAAM;EAC3C,IAAK,CAAEN,UAAU,CAACO,GAAG,CAAEF,GAAI,CAAC,EAAG;IAC9B,MAAMG,KAAK,GAAG,IAAIC,KAAK,CAAEJ,GAAG,EAAEK,QAAS,CAAC;IACxCV,UAAU,CAACW,GAAG,CAAEN,GAAG,EAAEG,KAAM,CAAC;IAC5BN,SAAS,CAACS,GAAG,CAAEH,KAAK,EAAEF,EAAG,CAAC;EAC3B;EACA,OAAON,UAAU,CAAChB,GAAG,CAAEqB,GAAI,CAAC;AAC7B,CAAC;AAED,MAAMK,QAAQ,GAAG;EAChB1B,GAAG,EAAEA,CAAEL,MAAW,EAAEE,GAAoB,EAAE+B,QAAa,KAAM;IAC5D,MAAMN,EAAE,GAAGJ,SAAS,CAAClB,GAAG,CAAE4B,QAAS,CAAC;;IAEpC;IACA;IACA;IACA,MAAM9B,MAAM,GAAGL,MAAM,CAACM,wBAAwB,CAAEJ,MAAM,EAAEE,GAAI,CAAC,EAAEG,GAAG;IAClE,IAAKF,MAAM,EAAG;MACb,MAAM+B,KAAK,GAAG7C,QAAQ,CAAC,CAAC;MACxB,IAAK6C,KAAK,EAAG;QACZ,MAAMC,OAAO,GACZX,cAAc,CAACnB,GAAG,CAAE6B,KAAM,CAAC,IAC3BV,cAAc,CAACQ,GAAG,CAAEE,KAAK,EAAE,IAAIjB,GAAG,CAAC,CAAE,CAAC,CAACZ,GAAG,CAAE6B,KAAM,CAAC;QACpD,IAAK,CAAEC,OAAO,CAACP,GAAG,CAAEzB,MAAO,CAAC,EAAG;UAC9BgC,OAAO,CAACH,GAAG,CACV7B,MAAM,EACNf,QAAQ,CAAE,MAAM;YACfK,YAAY,CAAEkC,EAAG,CAAC;YAClBrC,QAAQ,CAAE4C,KAAM,CAAC;YACjB,IAAI;cACH,OAAO/B,MAAM,CAACiC,IAAI,CAAEpC,MAAO,CAAC;YAC7B,CAAC,SAAS;cACTT,UAAU,CAAC,CAAC;cACZG,cAAc,CAAC,CAAC;YACjB;UACD,CAAE,CACH,CAAC;QACF;QACA,OAAOyC,OAAO,CAAC9B,GAAG,CAAEF,MAAO,CAAC,CAACkC,KAAK;MACnC;IACD;IAEA,MAAMC,MAAM,GAAGC,OAAO,CAAClC,GAAG,CAAEL,MAAM,EAAEE,GAAG,EAAE+B,QAAS,CAAC;;IAEnD;IACA;IACA,IAAK,OAAOK,MAAM,KAAK,WAAW,IAAIL,QAAQ,KAAKjB,MAAM,CAACX,GAAG,CAAEsB,EAAG,CAAC,EAAG;MACrE,MAAMD,GAAG,GAAG,CAAC,CAAC;MACda,OAAO,CAACP,GAAG,CAAEhC,MAAM,EAAEE,GAAG,EAAEwB,GAAG,EAAEO,QAAS,CAAC;MACzC,OAAOR,OAAO,CAAEC,GAAG,EAAEC,EAAG,CAAC;IAC1B;;IAEA;IACA;IACA;IACA,IAAKW,MAAM,EAAEzC,WAAW,EAAE2C,IAAI,KAAK,mBAAmB,EAAG;MACxD,OAAO,OAAQ,GAAGC,IAAe,KAAM;QACtC,MAAMP,KAAK,GAAG7C,QAAQ,CAAC,CAAC;QACxB,MAAMqD,GAAqB,GAAGJ,MAAM,CAAE,GAAGG,IAAK,CAAC;QAE/C,IAAIJ,KAAU;QACd,IAAIM,EAAyB;QAE7B,OAAQ,IAAI,EAAG;UACdlD,YAAY,CAAEkC,EAAG,CAAC;UAClBrC,QAAQ,CAAE4C,KAAM,CAAC;UACjB,IAAI;YACHS,EAAE,GAAGD,GAAG,CAACE,IAAI,CAAEP,KAAM,CAAC;UACvB,CAAC,SAAS;YACT9C,UAAU,CAAC,CAAC;YACZG,cAAc,CAAC,CAAC;UACjB;UAEA,IAAI;YACH2C,KAAK,GAAG,MAAMM,EAAE,CAACN,KAAK;UACvB,CAAC,CAAC,OAAQtB,CAAC,EAAG;YACb2B,GAAG,CAACG,KAAK,CAAE9B,CAAE,CAAC;UACf;UAEA,IAAK4B,EAAE,CAACG,IAAI,EAAG;QAChB;QAEA,OAAOT,KAAK;MACb,CAAC;IACF;;IAEA;IACA;IACA;IACA,IAAK,OAAOC,MAAM,KAAK,UAAU,EAAG;MACnC,OAAO,CAAE,GAAGG,IAAe,KAAM;QAChChD,YAAY,CAAEkC,EAAG,CAAC;QAClB,IAAI;UACH,OAAOW,MAAM,CAAE,GAAGG,IAAK,CAAC;QACzB,CAAC,SAAS;UACT/C,cAAc,CAAC,CAAC;QACjB;MACD,CAAC;IACF;;IAEA;IACA,IAAKC,QAAQ,CAAE2C,MAAO,CAAC,EAAG,OAAOb,OAAO,CAAEa,MAAM,EAAEX,EAAG,CAAC;IAEtD,OAAOW,MAAM;EACd;AACD,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMS,SAAS,GAAKC,SAAiB,IAC3C5B,YAAY,CAACf,GAAG,CAAE2C,SAAS,IAAIxD,YAAY,CAAC,CAAE,CAAC,IAAI,CAAC,CAAC;AA8BtD,MAAMyD,eAAe,GACpB,2GAA2G;;AAE5G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAaA,OAAO,SAASC,KAAKA,CACpBF,SAAiB,EACjB;EAAEG,KAAK,GAAG,CAAC,CAAC;EAAE,GAAGC;AAAW,CAAC,GAAG,CAAC,CAAC,EAClC;EAAEC,IAAI,GAAG;AAAoB,CAAC,GAAG,CAAC,CAAC,EAClC;EACD,IAAK,CAAErC,MAAM,CAACY,GAAG,CAAEoB,SAAU,CAAC,EAAG;IAChC;IACA;IACA;IACA,IAAKK,IAAI,KAAKJ,eAAe,EAAG;MAC/B9B,UAAU,CAACa,GAAG,CAAEgB,SAAS,EAAEK,IAAK,CAAC;IAClC;IACA,MAAMC,QAAQ,GAAG;MAAEH,KAAK,EAAEhE,UAAU,CAAEgE,KAAM,CAAC;MAAE,GAAGC;IAAM,CAAC;IACzD,MAAMG,YAAY,GAAG,IAAIzB,KAAK,CAAEwB,QAAQ,EAAEvB,QAAS,CAAC;IACpDb,SAAS,CAACc,GAAG,CAAEgB,SAAS,EAAEM,QAAS,CAAC;IACpCtC,MAAM,CAACgB,GAAG,CAAEgB,SAAS,EAAEO,YAAa,CAAC;IACrChC,SAAS,CAACS,GAAG,CAAEuB,YAAY,EAAEP,SAAU,CAAC;EACzC,CAAC,MAAM;IACN;IACA;IACA;IACA,IAAKK,IAAI,KAAKJ,eAAe,IAAI,CAAE9B,UAAU,CAACS,GAAG,CAAEoB,SAAU,CAAC,EAAG;MAChE7B,UAAU,CAACa,GAAG,CAAEgB,SAAS,EAAEK,IAAK,CAAC;IAClC,CAAC,MAAM;MACN,MAAMG,SAAS,GAAGrC,UAAU,CAACd,GAAG,CAAE2C,SAAU,CAAC;MAC7C,MAAMS,WAAW,GAChBJ,IAAI,KAAKJ,eAAe,IACtBI,IAAI,KAAK,IAAI,IAAIA,IAAI,KAAKG,SAAW;MAExC,IAAK,CAAEC,WAAW,EAAG;QACpB,IAAK,CAAED,SAAS,EAAG;UAClB,MAAME,KAAK,CAAE,4BAA6B,CAAC;QAC5C,CAAC,MAAM;UACN,MAAMA,KAAK,CACV,yDACD,CAAC;QACF;MACD;IACD;IAEA,MAAM1D,MAAM,GAAGkB,SAAS,CAACb,GAAG,CAAE2C,SAAU,CAAC;IACzCjD,SAAS,CAAEC,MAAM,EAAEoD,KAAM,CAAC;IAC1BrD,SAAS,CAAEC,MAAM,CAACmD,KAAK,EAAEA,KAAM,CAAC;EACjC;EAEA,OAAOnC,MAAM,CAACX,GAAG,CAAE2C,SAAU,CAAC;AAC/B;;AAEA;AACA,MAAMW,IAAI,GAAGnD,gBAAgB,CAAC,CAAC;AAC/B,IAAKb,QAAQ,CAAEgE,IAAI,EAAER,KAAM,CAAC,EAAG;EAC9BrD,MAAM,CAAC8D,OAAO,CAAED,IAAI,CAACR,KAAM,CAAC,CAACU,OAAO,CAAE,CAAE,CAAEb,SAAS,EAAEG,KAAK,CAAE,KAAM;IACjED,KAAK,CAAEF,SAAS,EAAE;MAAEG;IAAM,CAAC,EAAE;MAAEE,IAAI,EAAEJ;IAAgB,CAAE,CAAC;EACzD,CAAE,CAAC;AACJ;AACA,IAAKtD,QAAQ,CAAEgE,IAAI,EAAEG,MAAO,CAAC,EAAG;EAC/BhE,MAAM,CAAC8D,OAAO,CAAED,IAAI,CAACG,MAAO,CAAC,CAACD,OAAO,CAAE,CAAE,CAAEb,SAAS,EAAEc,MAAM,CAAE,KAAM;IACnE1C,YAAY,CAACY,GAAG,CAAEgB,SAAS,EAAEc,MAAO,CAAC;EACtC,CAAE,CAAC;AACJ"}